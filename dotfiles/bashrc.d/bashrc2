#!/bin/bash


export LESS='-R -i'
export PAGER=less
export EDITOR=run-editor.sh
#export EDITOR='emacsclient -a vim'

export PATH=$PATH:~/local/bin:~/.local/bin


if [[ -z "${PERL_LOCAL_LIB_ROOT}" ]]; then
  #echo perl-local-lib
  eval $(perl -Mlocal::lib)
fi

export PERLDOC="-MPod::Text::Color"


if [[ -d $HOME/bin ]]; then
  export PATH=$HOME/bin:$PATH
fi


if [[ -d $HOME/go/bin ]]; then
  export PATH=~/go/bin:$PATH
fi

if [[ -x ~/.local/bin/mise ]]; then
  eval "$(~/.local/bin/mise activate bash)"
fi


if [[ -d ~/.local/share/mise/shims ]]; then
  export PATH=~/.local/share/mise/shims:$PATH
fi


if [[ -x "$(command -v luarocks)" ]]; then
  eval "$(luarocks path)"
fi



if [[ "${-#*i}" == "$-" ]]; then
    # echo non_interactive > /dev/stderr
    true
else
    alias tmux='tmux -2'
    alias view='vim -R'

    if [[ -x "$(command -v batcat)" ]]; then
      alias bat=batcat
    fi

    if [[ -x "$(command -v fdfind)" ]]; then
      alias fd=fdfind
    fi

    if [[ -f /usr/share/doc/fzf/examples/key-bindings.bash ]]; then
        source /usr/share/doc/fzf/examples/key-bindings.bash
    elif [[ -f /usr/share/fzf/shell/key-bindings.bash ]]; then
        source /usr/share/fzf/shell/key-bindings.bash
    elif [[ -f /usr/share/fzf/key-bindings.bash ]]; then
        source /usr/share/fzf/key-bindings.bash
    fi

    source ~/.bashrc.d/sensible.bash
    source ~/.bashrc.d/git-aliases.bash
    source ~/.bashrc.d/completion.bash

    #if [[ -n $PS1 && -f ~/.bashrc.d/bash_prompt ]]; then
    #  . ~/.bashrc.d/bash_prompt
    #  ps1_colorful_theme
    #fi

    if [[ -x "$(command -v zoxide)" ]]; then
        eval "$(zoxide init bash)"
    fi

    if [[ -z $DISPLAY ]] && [[ -f ~/.use-startx-auto ]]; then
      dialog --title "login" --timeout 5 --yesno "start X session? (5 secs auto-ok)" 6 45
      if [[ $? == 0 || $? == 255 ]]; then
        startx &> ~/startx.log
      fi
    fi

fi

